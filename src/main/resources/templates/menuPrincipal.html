<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ToDaily</title>
    <link rel="stylesheet" href="/css/menuPrincipal.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
<div class="app-container">
    <aside class="sidebar">
        <h1 class="app-title">ToDaily</h1>

        <div class="perfil" onclick="abrirModalPerfil('modalPerfil')" style="cursor: pointer;">
            <div class="avatar">
                <i data-lucide="user"></i>
            </div>
            <div class="info">
                <p class="nome" th:text="${nome}">Generic User</p>
                <p class="email" th:text="${email}">genericemail@gmail.com</p>
            </div>
        </div>

        <nav class="menu">
            <button class="menu-item active" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="sun"></i> Para Hoje
            </button>
            <button class="menu-item" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="calendar"></i> Agendadas
            </button>
            <button class="menu-item" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="briefcase"></i> Áreas de Trabalho
            </button>
        </nav>

        <div class="busca">
            <input type="text" placeholder="Buscar" />
        </div>

        <div class="listas">
            <button class="lista" oncontextmenu="mostrarMenuContexto(event, 'menuContextoLista', this)" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="list"></i> Faculdade
            </button>
            <button class="lista" oncontextmenu="mostrarMenuContexto(event, 'menuContextoLista', this)" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="list"></i> Casa
            </button>
            <button class="lista" oncontextmenu="mostrarMenuContexto(event, 'menuContextoLista', this)" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="list"></i> Renomeada
            </button>
        </div>

        <button class="nova-lista" onclick="abrirModalPerfil('modalAddLista')">
            <i data-lucide="plus"></i> Nova Lista
        </button>
    </aside>

    <main class="conteudo">
        <div class="titulo">
            <h2 id="titulo-principal">Para Hoje</h2>
            <span id="subtitulo-principal">- 21/11/24</span>
        </div>

        <div class="add-tarefa">
            <i data-lucide="plus"></i>
            <span>Adicionar Tarefa</span>
        </div>

        <div class="botoes-flutuantes">
            <button><i data-lucide="plus-circle"></i></button>
            <button><i data-lucide="calendar-days"></i></button>
        </div>
    </main>

    <div id="modalPerfil" class="overlay-perfil" style="display: none;" onclick="fecharModalPerfil('modalPerfil')">
        <div class="perfil-modal" onclick="event.stopPropagation()">
            <h2 class="titulo-modal">Perfil</h2>
            <div class="foto-perfil">
                <div class="avatar-grande"><i data-lucide="user"></i></div>
                <button class="btn-alterar-foto">Alterar ou remover foto</button>
            </div>
            <form class="formulario-perfil">
                <div class="campo-perfil"><label>Alterar nome:</label><input type="text" placeholder="Seu nome" /></div>
                <div class="campos-inline">
                    <button type="button" class="btn-link">Alterar e-mail</button>
                    <button type="button" class="btn-link">Alterar senha:</button>
                </div>
                <div class="botoes-acao">
                    <button type="submit" class="btn-salvar">Salvar</button>
                    <button type="button" class="btn-cancelar" onclick="fecharModalPerfil('modalPerfil')">Cancelar</button>
                </div>
                <button type="button" class="btn-excluir" onclick="abrirModalPerfil('modalVerificacao')">Excluir Conta</button>
            </form>
        </div>
    </div>

    <div id="modalVerificacao" class="confirma-acao" style="display:none;">
        <form action="/logout" method="post">
            <div class ="Verificacao" onClick = "event.stopPropagation()">
                <h3 class="mensagem-verificacao"> Deseja Realmente remover sua conta?</h3>
                <div class="Botoes-de-Verificacao">
                    <button type="submit" class="btn-confirmar-V" onclick="fecharModalPerfil('modalVerificacao')">Sim </button>
                    <button type="button" class="btn-cancelar-V" onclick="fecharModalPerfil('modalVerificacao')">Não </button>
                </div>
            </div>
        </form>
    </div>

    <div id="modalAddLista" class="overlay-perfil" style="display: none;" onclick="fecharModalPerfil('modalAddLista')">
        <div class="modal-lista" onclick="event.stopPropagation()">
            <h3 class="titulo-modal-lista">Adicionar Lista</h3>
            <form class="form-lista">
                <div class="campo-lista">
                    <label for="nome-lista">Nome da Lista*</label>
                    <input type="text" id="nome-lista" placeholder="Nova Lista" />
                </div>
                <div class="campo-lista">
                    <label for="descricao-lista">Descrição:</label>
                    <textarea id="descricao-lista" rows="4"></textarea>
                </div>
                <p class="aviso-obrigatorio">(*) Este campo é obrigatório</p>
                <div class="botoes-acao-lista">
                    <button type="button" class="btn-ok" onclick="fecharModalPerfil('modalAddLista')">OK</button>
                    <button type="button" class="btn-cancelar-lista" onclick="fecharModalPerfil('modalAddLista')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="menuContextoLista" class="context-menu" style="display: none;">
        <button class="context-menu-item" onclick="abrirModalPerfil('modalEditLista')">Editar Lista</button>
        <button class="context-menu-item" onclick="abrirModalPerfil('modalRemoveLista')">Remover Lista</button>
    </div>

    <div id="modalEditLista" class="overlay-perfil" style="display: none;" onclick="fecharModalPerfil('modalEditLista')">
        <div class="modal-lista" onclick="event.stopPropagation()">
            <h3 class="titulo-modal-lista">Editar Lista</h3>
            <form class="form-lista">
                <div class="campo-lista">
                    <label for="nome-lista-edit">Nome da Lista*</label>
                    <input type="text" id="nome-lista-edit" value="RENOMEADA" />
                </div>
                <div class="campo-lista">
                    <label for="descricao-lista-edit">Descrição:</label>
                    <textarea id="descricao-lista-edit" rows="4"></textarea>
                </div>
                <p class="aviso-obrigatorio">(*) Este campo é obrigatório</p>
                <div class="botoes-acao-lista">
                    <button type="button" class="btn-ok" onclick="fecharModalPerfil('modalEditLista')">OK</button>
                    <button type="button" class="btn-cancelar-lista" onclick="fecharModalPerfil('modalEditLista')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalRemoveLista" class="confirma-acao" style="display: none;" onclick="fecharModalPerfil('modalRemoveLista')">
        <div class="modal-remover" onclick="event.stopPropagation()">
            <h3 class="modal-remover-mensagem">Deseja realmente remover esta lista?</h3>
            <div class="modal-remover-botoes">
                <button class="btn-remover-sim" onclick="executarRemocaoLista()">Sim</button>
                <button class="btn-remover-nao" onclick="fecharModalPerfil('modalRemoveLista')">Não</button>
            </div>
        </div>
    </div>

</div> <script>
    lucide.createIcons();

    // **** Variável para guardar qual lista será removida ****
    let listaParaRemover = null;

    // Funções Padrão dos Modais
    function abrirModalPerfil(nomeModal) {
        document.getElementById(nomeModal).style.display = 'flex';
        setTimeout(() => {
            const modal = document.getElementById(nomeModal);
            if (modal.querySelectorAll('[data-lucide]').length > 0) {
                lucide.createIcons();
            }
        }, 10);
    }

    function fecharModalPerfil(nomeModal) {
        document.getElementById(nomeModal).style.display = 'none';
    }

    // **** MODIFICAÇÃO: Adicionado 'elemento' para saber qual lista foi clicada ****
    function mostrarMenuContexto(event, menuId, elemento) {
        event.preventDefault();

        listaParaRemover = elemento; // Guarda o botão (ex: "Renomeada") na variável

        document.querySelectorAll('.context-menu').forEach(menu => menu.style.display = 'none');
        const menu = document.getElementById(menuId);
        menu.style.display = 'block';
        menu.style.left = (event.pageX + 5) + 'px';
        menu.style.top = (event.pageY + 5) + 'px';
    }

    window.addEventListener('click', (e) => {
        if (!e.target.closest('.context-menu-item')) {
            document.querySelectorAll('.context-menu').forEach(menu => {
                menu.style.display = 'none';
            });
        }
    });

    window.addEventListener('scroll', () => {
        document.querySelectorAll('.context-menu').forEach(menu => {
            menu.style.display = 'none';
        });
    }, true);


    // --- FUNÇÃO PARA MUDAR TÍTULO DA PÁGINA ---
    function mudarTituloPrincipal(elementoClicado) {
        const novoTitulo = elementoClicado.innerText.trim();
        const tituloH2 = document.getElementById('titulo-principal');
        const subtituloSpan = document.getElementById('subtitulo-principal');

        if (tituloH2) {
            tituloH2.innerText = novoTitulo;
        }

        if (subtituloSpan) {
            if (novoTitulo === "Para Hoje") {
                subtituloSpan.innerText = "- 21/11/24";
            } else {
                subtituloSpan.innerText = "";
            }
        }

        document.querySelectorAll('.menu-item, .lista').forEach(btn => {
            btn.classList.remove('active');
        });

        elementoClicado.classList.add('active');
    }

    // --- **** FUNÇÃO PARA EXECUTAR A REMOÇÃO DA LISTA **** ---
    function executarRemocaoLista() {
        // 1. Remove o item da lista (se ele estiver guardado)
        if (listaParaRemover) {
            listaParaRemover.remove(); // Remove o botão da barra lateral
            listaParaRemover = null; // Limpa a variável
        }

        // 2. Fecha o modal de confirmação
        fecharModalPerfil('modalRemoveLista');

        // 3. Simula um clique em "Para Hoje" para resetar a tela
        const btnParaHoje = document.querySelector('.menu-item'); // Pega o primeiro .menu-item
        if (btnParaHoje) {
            btnParaHoje.click(); // Clica em "Para Hoje"
        }
    }
</script>
</body>
</html>