<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ToDaily</title>
    <link rel="stylesheet" href="/css/menuPrincipal.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
<div class="app-container">
    <aside class="sidebar">
        <h1 class="app-title">ToDaily</h1>

        <div class="perfil" onclick="abrirModalPerfil('modalPerfil')" style="cursor: pointer;">
            <div class="avatar">
                <i data-lucide="user"></i>
            </div>
            <div class="info">
                <p class="nome" th:text="${nome}">Generic User</p>
                <p class="email" th:text="${email}">genericemail@gmail.com</p>
            </div>
        </div>

        <nav class="menu">
            <button class="menu-item active" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="sun"></i> Para Hoje
            </button>
            <button class="menu-item" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="calendar"></i> Agendadas
            </button>
            <button class="menu-item" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="briefcase"></i> √Åreas de Trabalho
            </button>
        </nav>

        <div class="busca">
            <input type="text" placeholder="Buscar" />
        </div>

        <div class="listas">
            <button class="lista" oncontextmenu="mostrarMenuContexto(event, 'menuContextoLista', this)" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="list"></i> Faculdade
            </button>
            <button class="lista" oncontextmenu="mostrarMenuContexto(event, 'menuContextoLista', this)" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="list"></i> Casa
            </button>
            <button class="lista" oncontextmenu="mostrarMenuContexto(event, 'menuContextoLista', this)" onclick="mudarTituloPrincipal(this)">
                <i data-lucide="list"></i> Renomeada
            </button>
        </div>

        <button class="nova-lista" onclick="abrirModalPerfil('modalAddLista')">
            <i data-lucide="plus"></i> Nova Lista
        </button>
    </aside>

    <main class="conteudo">
        <div class="titulo">
            <h2 id="titulo-principal">Para Hoje</h2>
            <span id="subtitulo-principal">- 21/11/24</span>
        </div>

        <div class="add-tarefa">
            <i data-lucide="plus"></i>
            <span>Adicionar Tarefa</span>
        </div>

        <div class="botoes-flutuantes">
            <button><i data-lucide="plus-circle"></i></button>
            <button><i data-lucide="calendar-days"></i></button>
        </div>
    </main>

    <!-- Modal de Perfil -->
    <div id="modalPerfil" class="overlay-perfil" style="display: none;" onclick="fecharModalPerfil('modalPerfil')">
        <div class="perfil-modal" onclick="event.stopPropagation()">
            <h2 class="titulo-modal">Perfil</h2>

            <!-- Foto de perfil -->
            <div class="foto-perfil">
                <div class="avatar-grande">
                    <i data-lucide="user"></i>
                </div>
                <button class="btn-alterar-foto">Alterar ou remover foto</button>
            </div>

            <!-- Informa√ß√µes do usu√°rio -->
            <div class="info-usuario">

                <div class="campo-info">
                    <label>Nome:</label>
                    <p th:text="${nome}">Generic User</p>
                </div>

                <div class="campo-info">
                    <label>E-mail:</label>
                    <p th:text="${email}">genericemail@gmail.com</p>
                </div>

                <div class="campo-info">
                    <label>Data de Nascimento:</label>
                    <p th:text="${dataNascimento}">01/01/2000</p>
                </div>
            </div>

            <!-- A√ß√µes do perfil -->
            <div class="formulario-perfil">
                <button type="button" class="btn-salvar" onclick="abrirModalAcao('editar')">Editar Conta</button>
                <button type="button" class="btn-excluir" onclick="abrirModalAcao('remover')">Excluir Conta</button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div id="modalVerificacao" class="confirma-acao" th:style="${abrirModal} == 'verificacao' ? 'display:flex;' : 'display:none;'" onclick="fecharModalPerfil('modalVerificacao')">
        <div class="verificacao" onclick="event.stopPropagation()">
            <h3 class="mensagem-verificacao" id="mensagemVerificacao">
                Deseja realmente executar esta a√ß√£o?
            </h3>

            <!-- Formul√°rio enviado ao backend -->
            <form id="formConfirmacao" method="post">
                <p th:if="${erro}" class="mensagem-erro" th:text="${erro}"></p>
                <div class="campo-senha">

                    <label for="senhaConfirmacao">Digite sua senha para confirmar:</label>
                    <input type="password" id="senhaConfirmacao" name="senha" placeholder="Sua senha" required />
                </div>

                <div class="botoes-verificacao">
                    <button type="submit" class="btn-confirmar-V">Confirmar</button>
                    <button type="button" class="btn-cancelar-V" onclick="fecharModalPerfil('modalVerificacao')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalAddLista" class="overlay-perfil" style="display: none;" onclick="fecharModalPerfil('modalAddLista')">
        <div class="modal-lista" onclick="event.stopPropagation()">
            <h3 class="titulo-modal-lista">Adicionar Lista</h3>
            <form class="form-lista">
                <div class="campo-lista">
                    <label for="nome-lista">Nome da Lista*</label>
                    <input type="text" id="nome-lista" placeholder="Nova Lista" />
                </div>
                <div class="campo-lista">
                    <label for="descricao-lista">Descri√ß√£o:</label>
                    <textarea id="descricao-lista" rows="4"></textarea>
                </div>
                <p class="aviso-obrigatorio">(*) Este campo √© obrigat√≥rio</p>
                <div class="botoes-acao-lista">
                    <button type="button" class="btn-ok" onclick="fecharModalPerfil('modalAddLista')">OK</button>
                    <button type="button" class="btn-cancelar-lista" onclick="fecharModalPerfil('modalAddLista')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="menuContextoLista" class="context-menu" style="display: none;">
        <button class="context-menu-item" onclick="abrirModalPerfil('modalEditLista')">Editar Lista</button>
        <button class="context-menu-item" onclick="abrirModalPerfil('modalRemoveLista')">Remover Lista</button>
    </div>

    <div id="modalEditLista" class="overlay-perfil" style="display: none;" onclick="fecharModalPerfil('modalEditLista')">
        <div class="modal-lista" onclick="event.stopPropagation()">
            <h3 class="titulo-modal-lista">Editar Lista</h3>
            <form class="form-lista">
                <div class="campo-lista">
                    <label for="nome-lista-edit">Nome da Lista*</label>
                    <input type="text" id="nome-lista-edit" value="RENOMEADA" />
                </div>
                <div class="campo-lista">
                    <label for="descricao-lista-edit">Descri√ß√£o:</label>
                    <textarea id="descricao-lista-edit" rows="4"></textarea>
                </div>
                <p class="aviso-obrigatorio">(*) Este campo √© obrigat√≥rio</p>
                <div class="botoes-acao-lista">
                    <button type="button" class="btn-ok" onclick="fecharModalPerfil('modalEditLista')">OK</button>
                    <button type="button" class="btn-cancelar-lista" onclick="fecharModalPerfil('modalEditLista')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalRemoveLista" class="confirma-acao" style="display: none;" onclick="fecharModalPerfil('modalRemoveLista')">
        <div class="modal-remover" onclick="event.stopPropagation()">
            <h3 class="modal-remover-mensagem">Deseja realmente remover esta lista?</h3>
            <div class="modal-remover-botoes">
                <button class="btn-remover-sim" onclick="executarRemocaoLista()">Sim</button>
                <button class="btn-remover-nao" onclick="fecharModalPerfil('modalRemoveLista')">N√£o</button>
            </div>
        </div>
    </div>

</div> <script>
    lucide.createIcons();

    // **** Vari√°vel para guardar qual lista ser√° removida ****
    let listaParaRemover = null;

    // Fun√ß√µes Padr√£o dos Modais
    function abrirModalPerfil(nomeModal) {
        document.getElementById(nomeModal).style.display = 'flex';
        setTimeout(() => {
            const modal = document.getElementById(nomeModal);
            if (modal.querySelectorAll('[data-lucide]').length > 0) {
                lucide.createIcons();
            }
        }, 10);
    }



    // **** MODIFICA√á√ÉO: Adicionado 'elemento' para saber qual lista foi clicada ****
    function mostrarMenuContexto(event, menuId, elemento) {
        event.preventDefault();

        listaParaRemover = elemento; // Guarda o bot√£o (ex: "Renomeada") na vari√°vel

        document.querySelectorAll('.context-menu').forEach(menu => menu.style.display = 'none');
        const menu = document.getElementById(menuId);
        menu.style.display = 'block';
        menu.style.left = (event.pageX + 5) + 'px';
        menu.style.top = (event.pageY + 5) + 'px';
    }

    window.addEventListener('click', (e) => {
        if (!e.target.closest('.context-menu-item')) {
            document.querySelectorAll('.context-menu').forEach(menu => {
                menu.style.display = 'none';
            });
        }
    });

    window.addEventListener('scroll', () => {
        document.querySelectorAll('.context-menu').forEach(menu => {
            menu.style.display = 'none';
        });
    }, true);


    // --- FUN√á√ÉO PARA MUDAR T√çTULO DA P√ÅGINA ---
    function mudarTituloPrincipal(elementoClicado) {
        const novoTitulo = elementoClicado.innerText.trim();
        const tituloH2 = document.getElementById('titulo-principal');
        const subtituloSpan = document.getElementById('subtitulo-principal');

        if (tituloH2) {
            tituloH2.innerText = novoTitulo;
        }

        if (subtituloSpan) {
            if (novoTitulo === "Para Hoje") {
                subtituloSpan.innerText = "- 21/11/24";
            } else {
                subtituloSpan.innerText = "";
            }
        }

        document.querySelectorAll('.menu-item, .lista').forEach(btn => {
            btn.classList.remove('active');
        });

        elementoClicado.classList.add('active');
    }

    // --- **** FUN√á√ÉO PARA EXECUTAR A REMO√á√ÉO DA LISTA **** ---
    function executarRemocaoLista() {
        // 1. Remove o item da lista (se ele estiver guardado)
        if (listaParaRemover) {
            listaParaRemover.remove(); // Remove o bot√£o da barra lateral
            listaParaRemover = null; // Limpa a vari√°vel
        }

        // 2. Fecha o modal de confirma√ß√£o
        fecharModalPerfil('modalRemoveLista');

        // 3. Simula um clique em "Para Hoje" para resetar a tela
        const btnParaHoje = document.querySelector('.menu-item'); // Pega o primeiro .menu-item
        if (btnParaHoje) {
            btnParaHoje.click(); // Clica em "Para Hoje"
        }
    }

    let acaoAtual = null;

    lucide.createIcons();

    /*
     * Abre o modal de confirma√ß√£o e define qual a√ß√£o o backend vai executar.
     * @param {string} tipo - 'editar' ou 'remover'
     */
    function abrirModalAcao(tipo) {
        const modal = document.getElementById('modalVerificacao');
        const mensagem = document.getElementById('mensagemVerificacao');
        const form = document.getElementById('formConfirmacao');

        if (tipo === 'editar') {
            mensagem.textContent = 'Deseja realmente editar sua conta?';
            form.action = '/editarConta'; // endpoint backend para edi√ß√£o
            acaoAtual = 'editar';
        } else if (tipo === 'remover') {
            mensagem.textContent = 'Deseja realmente remover sua conta?';
            form.action = '/removerConta'; // endpoint backend para exclus√£o
            acaoAtual = 'remover';
        }

        // limpa o campo de senha e mostra o modal
        document.getElementById('senhaConfirmacao').value = '';
        modal.style.display = 'flex';
    }

    /**
     * Fecha o modal (usado tamb√©m por bot√µes "Cancelar").
     */
    function fecharModalPerfil(nomeModal) {
        document.getElementById(nomeModal).style.display = 'none';
        const modal = document.getElementById(nomeModal);
        modal.style.display = 'none';

        // üîπ Remove mensagem de erro ao fechar o modal
        const erroMsg = modal.querySelector('.mensagem-erro');
        if (erroMsg) {
            erroMsg.textContent = '';
        }

        // üîπ Limpa o campo de senha, se existir
        const inputSenha = modal.querySelector('input[type="password"]');
        if (inputSenha) {
            inputSenha.value = '';
        }
    }

</script>
</body>
</html>