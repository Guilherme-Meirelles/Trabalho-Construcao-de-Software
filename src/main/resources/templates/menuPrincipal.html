<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ToDaily</title>
    <link rel="stylesheet" href="/css/menuPrincipal.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
<div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <h1 class="app-title">ToDaily</h1>

        <!-- Perfil -->
        <div class="perfil" onclick="abrirModalPerfil('modalPerfil')" style="cursor: pointer;">
            <div class="avatar">
                <i data-lucide="user"></i>
            </div>
            <div class="info">
                <!-- Substitui por dados reais -->
                <p class="nome" th:text="${nome}">Generic User</p>
                <p class="email" th:text="${email}">genericemail@gmail.com</p>
            </div>
        </div>

        <!-- Menu -->
        <nav class="menu">
            <button class="menu-item active">
                <i data-lucide="sun"></i> Para Hoje
            </button>
            <button class="menu-item">
                <i data-lucide="calendar"></i> Agendadas
            </button>
            <button class="menu-item">
                <i data-lucide="briefcase"></i> √Åreas de Trabalho
            </button>
        </nav>

        <!-- Busca -->
        <div class="busca">
            <input type="text" placeholder="Buscar" />
        </div>

        <!-- Listas -->
        <div class="listas">
            <button class="lista">Faculdade</button>
            <button class="lista">Casa</button>
        </div>

        <!-- Nova lista -->
        <button class="nova-lista">
            <i data-lucide="plus"></i> Nova Lista
        </button>
    </aside>

    <!-- Conte√∫do principal -->
    <main class="conteudo">
        <div class="titulo">
            <h2>Para Hoje</h2>
            <span>- 21/11/24</span>
        </div>

        <!-- Adicionar tarefa -->
        <div class="add-tarefa">
            <i data-lucide="plus"></i>
            <span>Adicionar Tarefa</span>
        </div>

        <!-- Bot√µes flutuantes -->
        <div class="botoes-flutuantes">
            <button><i data-lucide="plus-circle"></i></button>
            <button><i data-lucide="calendar-days"></i></button>
        </div>
    </main>

    <!-- Modal de Perfil -->
    <div id="modalPerfil" class="overlay-perfil" style="display: none;" onclick="fecharModalPerfil('modalPerfil')">
        <div class="perfil-modal" onclick="event.stopPropagation()">
            <h2 class="titulo-modal">Perfil</h2>

            <!-- Foto de perfil -->
            <div class="foto-perfil">
                <div class="avatar-grande">
                    <i data-lucide="user"></i>
                </div>
                <button class="btn-alterar-foto">Alterar ou remover foto</button>
            </div>

            <!-- Informa√ß√µes do usu√°rio -->
            <div class="info-usuario">

                <div class="campo-info">
                    <label>Nome:</label>
                    <p th:text="${nome}">Generic User</p>
                </div>

                <div class="campo-info">
                    <label>E-mail:</label>
                    <p th:text="${email}">genericemail@gmail.com</p>
                </div>

                <div class="campo-info">
                    <label>Data de Nascimento:</label>
                    <p th:text="${dataNascimento}">01/01/2000</p>
                </div>
            </div>

            <!-- A√ß√µes do perfil -->
            <div class="formulario-perfil">
                <button type="button" class="btn-salvar" onclick="abrirModalAcao('editar')">Editar Conta</button>
                <button type="button" class="btn-excluir" onclick="abrirModalAcao('remover')">Excluir Conta</button>
            </div>
        </div>
    </div>


    <!-- Modal de Confirma√ß√£o -->
    <div id="modalVerificacao" class="confirma-acao" th:style="${abrirModal} == 'verificacao' ? 'display:flex;' : 'display:none;'" onclick="fecharModalPerfil('modalVerificacao')">
        <div class="verificacao" onclick="event.stopPropagation()">
            <h3 class="mensagem-verificacao" id="mensagemVerificacao">
                Deseja realmente executar esta a√ß√£o?
            </h3>

            <!-- Formul√°rio enviado ao backend -->
            <form id="formConfirmacao" method="post">
                <p th:if="${erro}" class="mensagem-erro" th:text="${erro}"></p>
                <div class="campo-senha">

                    <label for="senhaConfirmacao">Digite sua senha para confirmar:</label>
                    <input type="password" id="senhaConfirmacao" name="senha" placeholder="Sua senha" required />
                </div>

                <div class="botoes-verificacao">
                    <button type="submit" class="btn-confirmar-V">Confirmar</button>
                    <button type="button" class="btn-cancelar-V" onclick="fecharModalPerfil('modalVerificacao')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let acaoAtual = null;

        lucide.createIcons();

        function abrirModalPerfil(nomeModal) {
            document.getElementById(nomeModal).style.display = 'flex';
            setTimeout(() => lucide.createIcons(), 10);
        }
        /**
         * Abre o modal de confirma√ß√£o e define qual a√ß√£o o backend vai executar.
         * @param {string} tipo - 'editar' ou 'remover'
         */
        function abrirModalAcao(tipo) {
            const modal = document.getElementById('modalVerificacao');
            const mensagem = document.getElementById('mensagemVerificacao');
            const form = document.getElementById('formConfirmacao');

            if (tipo === 'editar') {
                mensagem.textContent = 'Deseja realmente editar sua conta?';
                form.action = '/editarConta'; // endpoint backend para edi√ß√£o
                acaoAtual = 'editar';
            } else if (tipo === 'remover') {
                mensagem.textContent = 'Deseja realmente remover sua conta?';
                form.action = '/removerConta'; // endpoint backend para exclus√£o
                acaoAtual = 'remover';
            }

            // limpa o campo de senha e mostra o modal
            document.getElementById('senhaConfirmacao').value = '';
            modal.style.display = 'flex';
        }

        /**
         * Fecha o modal (usado tamb√©m por bot√µes "Cancelar").
         */
        function fecharModalPerfil(nomeModal) {
            document.getElementById(nomeModal).style.display = 'none';
            const modal = document.getElementById(nomeModal);
            modal.style.display = 'none';

            // üîπ Remove mensagem de erro ao fechar o modal
            const erroMsg = modal.querySelector('.mensagem-erro');
            if (erroMsg) {
                erroMsg.textContent = '';
            }

            // üîπ Limpa o campo de senha, se existir
            const inputSenha = modal.querySelector('input[type="password"]');
            if (inputSenha) {
                inputSenha.value = '';
            }
        }


    </script>

</div>
</body>
</html>